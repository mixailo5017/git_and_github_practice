window.fd={logging:!1},$(function(){"use strict";function e(){setTimeout(function(){var e=$(".cropper-container").height()+60;$(".crop-here").css({height:e})},500)}function o(e){$(".error-head").html(e)}function r(e){"error"===e.status&&o(e.error),"success"===e.status&&(window.location="/signup/confirm")}function t(e){$("#zone").removeClass("fd-zone"),$("#zone").removeClass("filedrop"),$(".fd-file, .drop-meta").hide(),$(".crop-controls, .crop-confirm").show(),p.attr("src",e).cropper({zoomable:!1,modal:!0,aspectRatio:1}),setTimeout(function(){var e=$(".cropper-container").height();$(".crop-wrap").css({height:e})},1e3)}function i(){var e=$("#cropper_image"),o=$(".crop-wrap");e.length&&(o.css({opacity:0}),d=$("#cropper_image").attr("src").replace("/images/signup/",""),$().hide(),$(".drop-meta").hide(),setTimeout(function(){$(".fd-file").hide(),o.animate({opacity:1},500)},500),t(e.attr("src")))}function n(){$.post(c,{}).success(function(){window.location.reload()}).fail(function(){o("ohh no!")})}function a(e,t){if(!l){l=!0;var i={"fd-file":t,"raw-file":e};$.post(s,i).success(function(e){r(e),l=!1}).fail(function(){f.removeClass("disabled"),o("There was an error saving the image."),l=!1})}}var s="/signup/photo/upload",c="/signup/photo/remove",d="",p=$(".crop-wrap > img"),f=$(".crop-zone"),u=null,l=!1;f.on("click","[data-method]",function(){var o=$(this),r=o.data(),t=o.attr("id");if(f.hasClass("disabled"))return!1;if(r.method&&(p.cropper(r.method,r.option),"rotate"===r.method&&e()),"saveImage"===t){var i=$(".cropper-container").height()/2;$(".progress").fadeIn("fast").prepend("Saving image please wait.").css({top:i}).children().css({width:"100%"}),f.addClass("disabled"),a(p.cropper("getDataURL"),d)}"removeImage"===t&&(f.addClass("disabled"),n())}),$("#rotateLeft").tipsy({gravity:"s"}),$("#rotateRight").tipsy({gravity:"s"}),$("html").hasClass("ie9")&&$('#basicUpload input[type="file"]').on("change",function(){$("#upload_photo").fadeIn()}),i(),!function(){return"draggable"in document.createElement("span")}()?function(){$("#basicUpload").show(),i()}():function(){$("#zone").show();var e={iframe:!1};u=new FileDrop("zone",e),u.event("send",function(e){e.each(function(e){o("");var r=Number(e.size/1024),i=Number(r/1024*100/100),n=e.name,a=n.replace(/^.*\./,"").toLowerCase();"png"!==a&&"jpg"!==a&&"gif"!==a?o("Error: File must be a 'jpg', 'png', or 'gif'"):i>5?o("Error: Upload file must be less than 5 MB"):($(".fd-file").hide(),$(".progress").fadeIn("fast"),e.event("progress",function(e,o){var r=e/o*100+"%";window.fd.byID("bar_zone").style.width=r}),e.event("done",function(e){$(".progress").fadeOut("fast",function(){var r=jQuery.parseJSON(e.responseText);return void 0!==r.status&&"success"===r.status?void t(r.original):void 0!==r.status&&"error"===r.status?(o("Error: "+r.error),void $(".fd-file").show()):(o("Error: File could not be uploaded"),void $(".fd-file").show())})}),e.sendTo(s)),e.event("error",function(){o("Error uploading "+this.name),$(".fd-file").show()})})})}()});